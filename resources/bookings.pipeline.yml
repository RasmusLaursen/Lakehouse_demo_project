variables:
  # Common variables used multiple places in the DAB definition.
  gateway_name:
    default: rahl-lakeflow-connect-gateway-sql-dab
  dest_catalog:
    default: ${resources.schemas.landing_schema.catalog_name}
  dest_schema:
    default: bronze_lakeflow_sql_server
  environment:
    default: dev

resources:
  pipelines:
    bookings_pipeline:
      name: bookings_pipeline_${var.environment}
      catalog: ${resources.schemas.bookings_landing_schema.catalog_name}
      schema: ${resources.schemas.bookings_landing_schema.name} 
      libraries:
        - glob:
            include: ../src/raw/raw_ingest_bookings.py
        - glob:
            include: ../src/base/base_ingest_bookings.py
            
      environment:
        dependencies:
          - ../dist/*.whl
        
      continuous: True

      configuration:
        bundle.sourcePath: ${workspace.file_path}/src
        environment: ${var.environment}
        landing_catalog: ${resources.schemas.lakehouse_landing_schema.catalog_name}
        raw_catalog: ${resources.schemas.lakehouse_raw_schema.catalog_name}
        base_catalog: ${resources.schemas.lakehouse_base_schema.catalog_name}
        enriched_catalog: ${resources.schemas.enriched_schema.catalog_name}
        curated_catalog: ${resources.schemas.dimensions_schema.catalog_name}

        lakehouse_landing_schema: ${resources.schemas.lakehouse_landing_schema.name}
        lakehouse_raw_schema: ${resources.schemas.lakehouse_raw_schema.name}
        lakehouse_base_schema: ${resources.schemas.lakehouse_base_schema.name}

        review_landing_schema: ${resources.schemas.review_landing_schema.name}
        review_raw_schema: ${resources.schemas.review_raw_schema.name}
        review_base_schema: ${resources.schemas.review_base_schema.name}

        bookings_landing_schema: ${resources.schemas.bookings_landing_schema.name}
        bookings_raw_schema: ${resources.schemas.bookings_raw_schema.name}
        bookings_base_schema: ${resources.schemas.bookings_base_schema.name}

        enriched_schema: ${resources.schemas.enriched_schema.name}

        dimensions_schema: ${resources.schemas.dimensions_schema.name}
        facts_schema: ${resources.schemas.facts_schema.name}
        
      serverless: True